%h6.titulo Datos Personales:
.form-group.row
  = f.label :ci, class: 'col-form-label col-md-3 text-right', value: 'Cédula de Identidad:'
  .col-md-9
    %input.form-control-plaintext.form-control.text-muted.form-control-plaintext{ value: @usuario.ci, readonly: true, disabled: true}
  = f.hidden_field :ci

- if @usuario and @usuario.eql? current_usuario and current_usuario.ci.eql? current_usuario.password
  .form-group.row
    = f.label :password, class: 'col-form-label col-md-3 text-right', value: 'Contraseña:'
    .col-md-9
      = f.password_field :password, required: true, class: 'text-field form-control'
  .form-group.row
    = f.label :password_confirmation, class: 'col-form-label col-md-3 text-right', value: 'Confirme Contraseña:'
    .col-md-9
      = f.password_field :password_confirmation, required: true, class: 'text-field form-control'
.form-group.row
  = f.label 'nacionalidad', class: 'col-form-label col-md-3 text-right', value: 'Nacionalidad:'
  .col-md-9
    - Usuario.nacionalidades.map do |k,v| 
      %label.btn.btn-secondary.btn-sm
        = radio_button_tag '[usuario]nacionalidad', k, (@usuario.nacionalidad.eql? k), required: true
        = k.upcase
.form-group.row
  = f.label :nombres, class: 'col-form-label col-md-3 text-right float-right', value: 'Nombres:'
  .col-md-9
    = f.text_field :nombres, required: true, class: 'text-field form-control upcase'
.form-group.row
  = f.label :apellidos, class: 'col-form-label col-md-3 text-right', value: 'Apellidos:'
  .col-md-9
    = f.text_field :apellidos, required: true, class: 'text-field form-control upcase'
.form-group.row
  = f.label :sexo, class: 'col-form-label col-md-3 text-right', value: 'Sexo:'
  .col-md-9
    - Usuario.sexos.map do |k,v| 
      %label.btn.btn-secondary.btn-sm.tooltip-btn{'data_toggle': :tooltip, title: k.titleize}
        = radio_button_tag '[usuario]sexo', k, (@usuario.sexo.eql? k), required: true
        = k[0].upcase
.form-group.row
  = f.label 'estado_civil', class: 'col-form-label col-md-3 text-right', value: 'Estado Civil:'
  .col-md-9
    - Usuario.estado_civiles.map do |k,v| 
      %label.btn.btn-secondary.btn-sm.tooltip-btn{'data_toggle': :tooltip, title: k}
        = radio_button_tag '[usuario]estado_civil', k, (@usuario.estado_civil.eql? k), required: true
        = k[0..4].upcase

%h6.titulo Datos de Contacto:
.form-group.row
  = f.label :email, class: 'col-form-label col-md-3 text-right', value: 'Correo Electrónico: '
  .col-md-9
    = f.email_field :email, class: 'text-field form-control'
.form-group.row
  = f.label :telefono_habitacion, class: 'col-form-label col-md-3 text-right', value: 'Número telefónico de habitación:'
  .col-md-9
    = f.phone_field :telefono_habitacion, class: 'text-field form-control'
.form-group.row
  = f.label :telefono_movil, class: 'col-form-label col-md-3 text-right', value: 'Número telefónico móvil:'
  .col-md-9
    = f.phone_field :telefono_movil, class: 'text-field form-control'

- if @usuario and @usuario.pais_nacimiento
  - data_hash = Usuario.naciones
  - @cities = data_hash[@usuario.pais_nacimiento].sort{|a,b| a <=> b}
  
- @cities ||= []
%h6.titulo Datos de Origen:

.form-group.row
  = f.label 'pais_nacimiento', class: 'col-form-label col-md-3 text-right', value: 'País de Nacimiento:'
  .col-md-9
    = f.select(:pais_nacimiento, Usuario.naciones.keys.sort, { include_blank: 'Selecciona País de Nacimiento...'}, {class: "dynamic form-control text_field", required: true, id: 'selectCountry', children: 'selectCity', url: countries_usuarios_path})

.form-group.row
  = f.label 'ciudad_nacimiento', class: 'col-form-label col-md-3 text-right', value: 'Ciudad de Nacimiento:'
  .col-md-9
    = f.select(:ciudad_nacimiento, @cities, { include_blank: 'Selecciona Ciudad de Nacimiento...'}, {class: "form-control text_field", required: true, id: 'selectCity'})
.form-group.row
  = f.label 'fecha_nacimiento', class: 'col-form-label col-md-3 text-right', value: 'Fecha de Nacimiento:'
  .col-md-9
    = f.date_field 'fecha_nacimiento', class: 'text-field form-control', required: true

%h6.titulo Dirección:

= hidden_field_tag '[direccion]estudiante_id', @usuario.ci

- @sector = @usuario.estudiante.direccion.sector if @usuario and @usuario.estudiante and @usuario.estudiante.direccion
- @calle = @usuario.estudiante.direccion.calle if @usuario and @usuario.estudiante and @usuario.estudiante.direccion
- @tipo_vivienda = @usuario.estudiante.direccion.tipo_vivienda if @usuario and @usuario.estudiante and @usuario.estudiante.direccion
- @nombre = @usuario.estudiante.direccion.nombre_vivienda if @usuario and @usuario.estudiante and @usuario.estudiante.direccion

  
.form-group.row
  %label.col-form-label.col-md-3.text-right Ubicación:
  .col-md-3
    = select_tag '[direccion]estado', options_for_select(Usuario.venezuela.map{|a| a["estado"]}), class: 'dynamic form-control text-field', required: true, include_blank: '--- Seleccione Estado ---', id: 'selectEstado', children: 'selectMunicipio', url: estados_usuarios_path
  .col-md-3
    = select_tag '[direccion]municipio', options_for_select([]), class: 'form-control text-field', required: true, include_blank: '--- Seleccione Municipio ---', id: 'selectMunicipio', childer: 'selectParroquia', url: estados_usuarios_path
  .col-md-3
    = select_tag '[direccion]ciudad', options_for_select([]), class: 'form-control text-field', required: true, include_blank: '--- Seleccione Parroquia ---', id: 'selectParroquia', url: estados_usuarios_path
    =# text_field_tag '[direccion]ciudad', nil, class: 'text-field form-control', placeholder: 'Ciudad/Parroquia', required: true
  = render 'layouts/cargando'
.form-group.row
  %label.col-form-label.col-md-3.text-right Urbanización/Sector:
  .col-md-9
    = text_field_tag '[direccion]sector', @sector, class: 'text-field form-control', required: true

.form-group.row
  %label.col-form-label.col-md-3.text-right Calle/Avenida:
  .col-md-9
    = text_field_tag '[direccion]calle', @calle, class: 'text-field form-control', required: true

.form-group.row
  %label.col-form-label.col-md-3.text-right Tipo de Vivienda:
  .col-md-9
    %label.btn.btn-secondary.btn-sm
      = radio_button_tag '[direccion]tipo_vivienda', 'Casa', ('Casa'.eql? @tipo_vivienda), required: true
      Casa
    %label.btn.btn-secondary.btn-sm
      = radio_button_tag '[direccion]tipo_vivienda', 'Quinta', ('Quinta'.eql? @tipo_vivienda), required: true
      Quinta
    %label.btn.btn-secondary.btn-sm
      = radio_button_tag '[direccion]tipo_vivienda', 'Apartamento', ('Apartamento'.eql? @tipo_vivienda), required: true
      Apartamento
.form-group.row
  %label.col-form-label.col-md-3.text-right Nombre/Número:
  .col-md-9
    = text_field_tag '[direccion]nombre_vivienda', @nombre, class: 'text-field form-control', required: true


%h6.titulo Discapacidad:

.form-group.row
  %label.col-form-label.col-md-3.text-right 
#discapacidad
  - @disca = @usuario.estudiante.discapacidad if @usuario and @usuario.estudiante
  .form-group.row
    %label.col-form-label.col-md-3.text-right ¿Posee usted alguna discapacidad? Indique:
    .col-md-9
      - Usuario::DISCAPACIDADES.each do |d| 
        %label.btn.btn-secondary.btn-sm
          = radio_button_tag "[estudiante]discapacidad", d, (@disca.eql? d)
          = d.upcase
      %label.btn.btn-secondary.btn-sm
        = radio_button_tag "[estudiante]discapacidad", 'Otro', false
        Otro

%h6.titulo Otro título universitario:
#universitario
  - @titulo_universitario = @usuario.estudiante.titulo_universitario if @usuario and @usuario.estudiante
  - @titulo_universidad = @usuario.estudiante.titulo_universidad if @usuario and @usuario.estudiante
  - @titulo_anno = @usuario.estudiante.titulo_anno if @usuario and @usuario.estudiante
  .form-group.row
    %label.col-form-label.col-md-3.text-right ¿Es egresado universitario? indique título optenido:
    .col-md-9
      = text_field_tag '[estudiante]titulo_universitario', @titulo_universitario, class: 'text-field form-control'
  .form-group.row
    %label.col-form-label.col-md-3.text-right Universidad:
    .col-md-9
      = text_field_tag '[estudiante]titulo_universidad', @titulo_universidad, class: 'text-field form-control' 
  .form-group.row
    %label.col-form-label.col-md-3.text-right Año:
    .col-md-9
      =# text_field_tag '[estudiante]titulo_anno', nil, class: 'text-field form-control', value: titulo_anno
      = select_year @titulo_anno.to_i, {start_year: Time.now.year, prompt: '--- N/A ---', end_year: Time.now.year - 30},{class: 'text-field form-control'}
      =# select_year(14{prompt: '--- Ninguno ---', field_name: '[estudiante]titulo_anno'}, {class: 'text-field form-control'})



:javascript
  $(document).ready(function() {

    $('#selectMunicipio').on('change', function(e){
      let estado = $('#selectEstado').val();

      console.log(estado)
      sendData(`#{getParroquias_usuarios_path}`, 'selectParroquia', {term: $(this).val(), estado: estado})

    })


    function sendData(url, children, data){
      $.ajax({
        url: url,
        dataType: 'json', 
        type: 'GET',
        data: data,
        beforeSend: function(xhr) {
          xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))
          $('#cargando a').html(`Cangando... `)
          $('#cargando').modal({keyboard: false, show: true, backdrop: 'static'})
        },
        success: function (data) {

          $('#'+children).empty();
          $('#'+children).append($("<option></option>").attr("value",'').text('--- Seleccione ---'));

          for (let e of data){
            $('#'+children)
              .append($("<option></option>")
                .attr("value",e)
                .text(e));             
          }
        },
        complete: function(){
          $('#cargando').modal('hide');
        }
      });
    };

    $('.dynamic').on('change', function(e){
      let children = $(this).attr('children');
      let url = $(this).attr('url');

      sendData(url, children, {term: $(this).val()})

    });
  });
